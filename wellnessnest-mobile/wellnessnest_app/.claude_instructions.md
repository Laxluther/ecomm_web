# Claude Code Instructions for WellnessNest Flutter Android App

## Project Overview
You are building a Flutter Android app for WellnessNest Coffee e-commerce platform. The app will connect to the existing Flask backend API and provide a seamless shopping experience similar to Myntra's mobile app. The app allows browsing without login but requires authentication for purchases.

## Your Role
You are an expert Flutter developer creating a production-ready Android app with:
- Modern Material Design 3 UI inspired by Myntra
- Smooth animations and transitions
- Offline support with proper caching
- Excellent user experience and performance
- Integration with existing Flask backend API

## Backend API Information

### Base URL
- Development: `http://localhost:5000/api`
- Production: Will be provided later

### Available Endpoints

#### Public Endpoints (No Auth Required)
```
GET /api/public/categories - Get all categories
GET /api/user/products - Get products (with filters)
GET /api/user/products/{id} - Get product details
GET /api/user/products/featured - Get featured products
POST /api/user/referrals/validate - Validate referral code
```

#### User Authentication
```
POST /api/user/auth/register - User registration
POST /api/user/auth/login - User login
GET /api/user/auth/me - Get current user profile
```

#### Protected User Endpoints (Auth Required)
```
# Cart
GET /api/user/cart - Get cart items
POST /api/user/cart/add - Add to cart
PUT /api/user/cart/update - Update cart item
DELETE /api/user/cart/remove/{product_id} - Remove from cart

# Wishlist
GET /api/user/wishlist - Get wishlist
POST /api/user/wishlist/add - Add to wishlist
DELETE /api/user/wishlist/remove/{product_id} - Remove from wishlist

# Orders
GET /api/user/orders - Get user orders
GET /api/user/orders/{order_id} - Get order details
POST /api/user/orders - Create order

# Addresses
GET /api/user/addresses - Get saved addresses
POST /api/user/addresses - Add new address
PUT /api/user/addresses/{id} - Update address
DELETE /api/user/addresses/{id} - Delete address

# Referrals & Wallet
GET /api/user/referrals - Get referral info
GET /api/user/wallet - Get wallet balance
```

## Flutter App Structure

### Directory Structure
```
lib/
├── main.dart
├── app.dart
├── config/
│   ├── constants.dart
│   ├── theme.dart
│   └── routes.dart
├── core/
│   ├── api/
│   │   ├── api_client.dart
│   │   ├── api_endpoints.dart
│   │   └── interceptors.dart
│   ├── errors/
│   │   └── exceptions.dart
│   └── utils/
│       ├── validators.dart
│       ├── formatters.dart
│       └── helpers.dart
├── data/
│   ├── models/
│   │   ├── product.dart
│   │   ├── category.dart
│   │   ├── user.dart
│   │   ├── cart_item.dart
│   │   ├── order.dart
│   │   └── address.dart
│   ├── repositories/
│   │   ├── auth_repository.dart
│   │   ├── product_repository.dart
│   │   ├── cart_repository.dart
│   │   └── order_repository.dart
│   └── providers/
│       ├── auth_provider.dart
│       ├── cart_provider.dart
│       └── wishlist_provider.dart
├── presentation/
│   ├── screens/
│   │   ├── onboarding/
│   │   │   ├── onboarding_screen.dart
│   │   │   └── widgets/
│   │   ├── auth/
│   │   │   ├── login_screen.dart
│   │   │   ├── register_screen.dart
│   │   │   └── widgets/
│   │   ├── home/
│   │   │   ├── home_screen.dart
│   │   │   └── widgets/
│   │   ├── categories/
│   │   │   └── categories_screen.dart
│   │   ├── products/
│   │   │   ├── products_list_screen.dart
│   │   │   ├── product_details_screen.dart
│   │   │   └── widgets/
│   │   ├── search/
│   │   │   └── search_screen.dart
│   │   ├── cart/
│   │   │   ├── cart_screen.dart
│   │   │   └── widgets/
│   │   ├── wishlist/
│   │   │   └── wishlist_screen.dart
│   │   ├── profile/
│   │   │   ├── profile_screen.dart
│   │   │   ├── addresses_screen.dart
│   │   │   ├── orders_screen.dart
│   │   │   ├── wallet_screen.dart
│   │   │   └── referrals_screen.dart
│   │   └── checkout/
│   │       ├── checkout_screen.dart
│   │       └── order_success_screen.dart
│   ├── widgets/
│   │   ├── product_card.dart
│   │   ├── category_chip.dart
│   │   ├── loading_indicator.dart
│   │   ├── error_widget.dart
│   │   └── empty_state.dart
│   └── navigation/
│       └── bottom_navigation.dart
└── shared/
    └── extensions/
```

## Key Features to Implement

### 1. Onboarding (First Time Users)
```dart
// 3-4 introduction panels showing:
- Welcome to WellnessNest
- Browse Premium Coffee Products
- Track Orders & Get Rewards
- Shop with Confidence

// Store onboarding completion in SharedPreferences
// Show only on first app launch
```

### 2. App Navigation
```dart
// Bottom Navigation with 5 tabs:
- Home (Browse without login)
- Categories (Browse without login)
- Cart (Login required)
- Wishlist (Login required)
- Profile (Login required)

// Deep linking support for products
```

### 3. Authentication Flow
```dart
// Registration with:
- First Name, Last Name
- Email, Password
- Phone Number
- Optional Referral Code

// Login with:
- Email & Password
- JWT token storage
- Auto-refresh token logic
- Biometric authentication (optional)
```

### 4. Home Screen Features
```dart
// Scrollable sections:
- Search Bar (sticky)
- Banner Carousel
- Categories Grid (4-6 categories)
- Featured Products Horizontal List
- All Products Grid
- Pull to refresh
```

### 5. Product Features
```dart
// Product List:
- Grid/List view toggle
- Filters (Category, Price, Sort)
- Search functionality
- Infinite scroll pagination

// Product Details:
- Image carousel
- Product info (name, price, description)
- Quantity selector
- Add to Cart button
- Add to Wishlist heart icon
- Similar products section
```

### 6. Cart Management
```dart
// Cart Features:
- Show cart items with images
- Update quantity
- Remove items
- Show price breakdown
- Apply coupon code
- Proceed to checkout
```

### 7. Checkout Process
```dart
// Checkout Steps:
1. Select/Add delivery address
2. Order summary
3. Payment method (COD only for now)
4. Place order
5. Order confirmation screen
```

### 8. User Profile
```dart
// Profile Sections:
- User info display
- My Orders
- Saved Addresses
- Wishlist
- Wallet/Rewards
- Referrals (Share & Earn)
- Settings
- Logout
```

## UI/UX Design Guidelines

### Design Inspiration (Myntra-like)
```dart
// Color Scheme
primary: Color(0xFF4CAF50), // Green theme for WellnessNest
secondary: Color(0xFF8BC34A),
background: Colors.grey[50],
surface: Colors.white,
error: Colors.red[400],

// Typography
- Use Google Fonts: 'Poppins' or 'Inter'
- Clear hierarchy with sizes: 24, 20, 18, 16, 14, 12

// Components
- Rounded corners (8-12 radius)
- Subtle shadows
- Smooth animations (300ms duration)
- Skeleton loading screens
- Pull to refresh everywhere
```

### Key UI Components

```dart
// Product Card (Myntra Style)
Container(
  child: Column(
    - AspectRatio 3:4 image
    - Brand name (grey, small)
    - Product name (black, medium)
    - Price row (discount price, original price, discount %)
    - Rating stars
    - Wishlist heart icon (top-right overlay)
  )
)

// Sticky Add to Cart Bar
Container(
  - Fixed bottom position
  - Shadow effect
  - Add to Cart and Buy Now buttons
  - Animated entry/exit
)
```

## State Management

Use **Provider** or **Riverpod** for state management:

```dart
// Key Providers:
- AuthProvider (user authentication state)
- CartProvider (cart items, count, total)
- WishlistProvider (wishlist items)
- ProductProvider (products, filters, search)
- OrderProvider (orders history)
```

## Data Models

```dart
// Product Model
class Product {
  final int productId;
  final String productName;
  final String description;
  final double price;
  final double? discountPrice;
  final String? primaryImage;
  final String brand;
  final String categoryName;
  final int stockQuantity;
  
  // Calculate discount percentage
  int get discountPercentage => 
    discountPrice != null 
      ? (((price - discountPrice!) / price) * 100).round()
      : 0;
}

// Cart Item Model
class CartItem {
  final int cartId;
  final Product product;
  int quantity;
  
  double get totalPrice => 
    (product.discountPrice ?? product.price) * quantity;
}
```

## API Integration

```dart
// API Client Setup
class ApiClient {
  static const baseUrl = 'http://localhost:5000/api';
  late Dio dio;
  
  ApiClient() {
    dio = Dio(BaseOptions(
      baseUrl: baseUrl,
      connectTimeout: 5000,
      receiveTimeout: 3000,
    ));
    
    // Add JWT interceptor
    dio.interceptors.add(AuthInterceptor());
    
    // Add logging interceptor for debugging
    dio.interceptors.add(LogInterceptor());
  }
}

// Auth Interceptor
class AuthInterceptor extends Interceptor {
  @override
  void onRequest(RequestOptions options, handler) {
    final token = StorageService.getToken();
    if (token != null) {
      options.headers['Authorization'] = 'Bearer $token';
    }
    handler.next(options);
  }
}
```

## Local Storage

```dart
// Use shared_preferences for:
- JWT token
- User preferences
- Cart cache
- Recent searches
- Onboarding completion flag

// Use sqflite for:
- Offline product catalog
- Order history cache
- Address book
```

## Error Handling

```dart
// Global error handling:
try {
  // API call
} on DioError catch (e) {
  if (e.response?.statusCode == 401) {
    // Navigate to login
  } else if (e.type == DioErrorType.connectTimeout) {
    // Show "No internet" message
  } else {
    // Show generic error
  }
}
```

## Performance Optimization

1. **Image Caching**: Use `cached_network_image` package
2. **Lazy Loading**: Implement pagination for products
3. **Debouncing**: Add debounce to search input
4. **Skeleton Screens**: Show loading placeholders
5. **Offline Support**: Cache critical data locally

## Security Considerations

1. Store JWT tokens securely using `flutter_secure_storage`
2. Implement certificate pinning for production
3. Obfuscate code for release builds
4. Validate all user inputs
5. Implement rate limiting for API calls

## Testing Requirements

```dart
// Unit Tests:
- Model serialization/deserialization
- Business logic in providers
- Utility functions

// Widget Tests:
- Product card rendering
- Cart calculations
- Form validations

// Integration Tests:
- Complete user flows (browse → add to cart → checkout)
- Authentication flow
- API error handling
```

## Development Phases

### Phase 1: Foundation (Week 1)
- Project setup and structure
- Theme configuration
- API client setup
- Basic navigation
- Onboarding screens

### Phase 2: Core Features (Week 2)
- Authentication (login/register)
- Home screen with categories
- Product list and details
- Search functionality

### Phase 3: User Features (Week 3)
- Cart management
- Wishlist
- User profile
- Address management

### Phase 4: Checkout & Orders (Week 4)
- Checkout flow
- Order placement
- Order history
- Referral system

### Phase 5: Polish & Testing (Week 5)
- UI animations
- Performance optimization
- Bug fixes
- Testing

## Package Dependencies

```yaml
dependencies:
  flutter:
    sdk: flutter
  
  # State Management
  provider: ^6.1.0
  
  # API & Networking
  dio: ^5.3.0
  pretty_dio_logger: ^1.3.0
  
  # UI Components
  flutter_svg: ^2.0.0
  cached_network_image: ^3.3.0
  carousel_slider: ^4.2.0
  shimmer: ^3.0.0
  lottie: ^2.6.0
  
  # Storage
  shared_preferences: ^2.2.0
  flutter_secure_storage: ^9.0.0
  sqflite: ^2.3.0
  
  # Utilities
  intl: ^0.18.0
  flutter_dotenv: ^5.1.0
  url_launcher: ^6.1.0
  
  # Forms & Validation
  flutter_form_builder: ^9.1.0
  form_builder_validators: ^9.1.0
```

## Important Notes

1. **No Admin Features**: The app should not include any admin functionality
2. **Guest Browsing**: Users can browse products without login
3. **Login Prompt**: Show login screen when user tries to:
   - Add to cart
   - Add to wishlist
   - View profile
   - Checkout

4. **Image URLs**: Backend returns relative URLs, convert to absolute:
   ```dart
   String getImageUrl(String? relativePath) {
     if (relativePath == null) return 'assets/images/placeholder.png';
     return 'http://localhost:5000$relativePath';
   }
   ```

5. **Price Display**: Always show prices in INR (₹)
6. **COD Only**: Currently only Cash on Delivery is supported

## Response Format

When implementing features, always:
1. Create complete, working code
2. Include proper error handling
3. Add loading states
4. Implement pull-to-refresh where applicable
5. Add appropriate animations
6. Follow Flutter best practices
7. Write clean, maintainable code

## Success Metrics

The app should achieve:
- Smooth 60 FPS performance
- < 3 second cold start time
- Offline browsing capability
- Intuitive user experience
- Professional Myntra-like design
- Zero crashes in production

Remember: This is a production app for WellnessNest Coffee. Focus on creating a delightful shopping experience that converts browsers into buyers!